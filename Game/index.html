<!doctype html>
<meta charset="utf-8">
<title>BTP600 - Assignment 2</title>

<body>
	<script src="pixi.js/bin/pixi.js"></script>
	<script type="text/javascript" src="supportlib.js"></script>
	<script src="Goblin.js"></script>
	<script src="Key.js"></script>
	<script src="Hero.js"></script>
  <script src="Door.js"></script>
	<script type="text/javascript">
		var stage = new PIXI.Stage(0x000000);
		var renderer = PIXI.autoDetectRenderer(
			512, 512, {
				antialiasing: false,
				transparent: false,
				resolution: 1
			}
		);

		document.body.appendChild(renderer.view);

		// Load tileset
		var loader = new PIXI.AssetLoader([
			"assets/tileset.png",
			"assets/dungeon.png",
			"assets/goblin.png",
			"assets/key.png",
			"assets/door-tile.png"
		]);

		loader.onComplete = setup;

		loader.load();

		var hero,
			goblin,
			dungeon,
			state,
			message,
			door = {},
			frames = {},
			movementInterval,
			goblinInterval,
			monstersMoving,
			gameOverScene,
			gameStartScene,
			sprites = {},
			gamePlayScene;

		// Function to load tileset and use sprite from it.
		function setup() {
			// Setting up scenes
			gamePlayScene = new PIXI.DisplayObjectContainer();
			gameOverScene = new PIXI.DisplayObjectContainer();

			stage.addChild(gamePlayScene);
			stage.addChild(gameOverScene);

			gameOverScene.visible = false;

			// Dungeon Texture
			var dungeonTexture = PIXI.TextureCache["assets/dungeon.png"];
			dungeon = new PIXI.Sprite(dungeonTexture);
			gamePlayScene.addChild(dungeon);

			monstersMoving = false;
			message = new PIXI.Text(
				"Save the princess!", {
					font: "32px courier",
					fill: "white"
				}
			);

			message.position.set(128, 256);
			gamePlayScene.addChild(message);


      /**************HERO BEGIN*************/
      //Creates a new Hero object and adds it to the PlayScene
      hero = new Hero();
      gamePlayScene.addChild(hero.getSprite());

      /**************HERO END*************/

      
      /**************DOOR BEGIN*************/
      door = new Door();
      gamePlayScene.addChild(door.north);
      gamePlayScene.addChild(door.south);
      gamePlayScene.addChild(door.west);
      gamePlayScene.addChild(door.east);
      /**************DOOR END*************/
      
			// Goblin
			goblin = new Goblin();
			gamePlayScene.addChild(goblin.getSprite());
			goblin.animateFront();


			//////////////////////////////////////////////
			// KEY
			/////////////////////////////////////////////
      
			key = new Key();
			key.spawn();
			gamePlayScene.addChild(key.getSprite());
      

			// Set game state
			state = play;

			//Render the stage
			renderer.render(stage);

			//Start the game loop
			gameLoop();
		}

		function gameLoop() {

			//Loop this function at 60 frames per second
			requestAnimationFrame(gameLoop);

			//Update the current game state
			state();

			//Render the stage to see the animation
			renderer.render(stage);
		}


		function play() {
      
      //Element movement
      hero.moveHero(); 
			goblin.moveVertical();

      /**********Collision section Begin**********/

			if (hitTestRectangle(hero, door.north)) {
				gameOverScene.visible = true;
				gamePlayScene.visible = false;
			}

			//check for a collision between the Hero and the Goblin
			if (hitTestRectangle(hero.getSprite(), goblin.getSprite())) {
				//if there's a collision, change the message text
				//and tint the box red
				message.setText("Aaagghh, you died!");
				hero.getSprite().tint = 0xff3300;
			} 
      else if(hitTestRectangle(hero.getSprite(), key.getSprite())) {
        //if there's a collision, change the message text
				//and tint the box red
				message.setText("Free The princess!");
        hero.getSprite().tint = 0xffff00;
      }
      else {
				//if there's no collision, reset the message text 
        //and the hero's colour
				message.setText("No collision...");
				hero.getSprite().tint = 0xffffff;
			}
      
      /***********Collision section End***********/
      
		}

	</script>
</body>